name: Alternative Package Sources

on:
  workflow_dispatch:

jobs:
  alt-sources:
    runs-on: ubuntu-22.04
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Try alternative package sources
      run: |
        echo "=== Current sources ==="
        cat /etc/apt/sources.list
        
        echo "=== Adding universe repository ==="
        sudo add-apt-repository universe
        sudo add-apt-repository multiverse
        
        echo "=== Update package lists ==="
        sudo apt-get update
        
        echo "=== Search for libunwind packages ==="
        apt-cache search libunwind | head -10
        
        echo "=== Try installing libunwind alternatives ==="
        sudo apt-get install -y libunwind8 libunwind8-dev || echo "libunwind8 failed"
        
        echo "=== Check what's available ==="
        apt-cache show libgstreamer1.0-dev | grep -A5 -B5 "Depends:"
        
        echo "=== Try installing GStreamer step by step ==="
        sudo apt-get install -y gstreamer1.0-tools || echo "gstreamer tools failed"
        sudo apt-get install -y libgstreamer1.0-0 || echo "gstreamer lib failed"
        sudo apt-get install -y libgstreamer1.0-dev || echo "gstreamer dev failed"

    - name: Alternative approach - build without problematic packages
      run: |
        echo "=== Install only working packages ==="
        sudo apt-get install -y \
          build-essential \
          cmake \
          pkg-config \
          libsdl2-dev \
          libgl1-mesa-dev \
          libegl1-mesa-dev
          
    - name: Test basic build
      working-directory: ./CameraApp
      run: |
        echo "=== Testing build without GStreamer ==="
        mkdir -p build-alt
        cd build-alt
        
        # Try to configure without GStreamer by commenting it out temporarily
        sed 's/pkg_check_modules(GSTREAMER REQUIRED gstreamer-1.0 gstreamer-app-1.0)/# &/' ../CMakeLists.txt > CMakeLists-no-gst.txt
        sed 's/\${GSTREAMER_LIBRARIES}//' CMakeLists-no-gst.txt > CMakeLists-modified.txt
        sed 's/\${GSTREAMER_INCLUDE_DIRS}//' CMakeLists-modified.txt > CMakeLists-final.txt
        
        # Use the modified CMakeLists
        cmake -f ../CMakeLists-final.txt .. -DSIMULATE_ALL_HARDWARE=ON || echo "Even basic cmake failed"